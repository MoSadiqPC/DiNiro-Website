{% extends 'layout.html' %}
{% block title %}{{ get_text('shop') }} - DI NIRO{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>{{ get_text('our') }} <span>{{ get_text('games') }}</span></h1>
    </div>

    <div class="controls-section" style="margin-bottom: 2rem; padding: 1.5rem; background: var(--bg-surface); border-radius: 8px; display: flex; flex-wrap: wrap; gap: 1.5rem; align-items: center;">
        <form action="{{ url_for('shop') }}" method="GET" style="display: flex; gap: 1rem; flex-grow: 1;">
            <input type="text" name="search" placeholder="{{ get_text('search') }}..." value="{{ search_query or '' }}" style="padding: 10px 15px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-main); color: var(--text-primary); flex-grow: 1;">
            <button type="submit" class="submit-btn" style="width: auto; padding: 10px 20px; margin-top: 0;">{{ get_text('search') }}</button>
        </form>
        <form action="{{ url_for('shop') }}" method="GET" style="display: flex; gap: 1rem; align-items: center;">
            <input type="hidden" name="search" value="{{ search_query or '' }}"> {# Keep search query when sorting #}
            <label for="sort" style="color: var(--text-secondary); margin-bottom: 0;">{{ get_text('sort_by') }}:</label>
            <select name="sort" id="sort" onchange="this.form.submit()" style="padding: 10px 15px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-main); color: var(--text-primary);">
                <option value="default" {% if sort_option == 'default' %}selected{% endif %}>{{ get_text('default') }}</option>
                <option value="price_asc" {% if sort_option == 'price_asc' %}selected{% endif %}>{{ get_text('price_asc') }}</option>
                <option value="price_desc" {% if sort_option == 'price_desc' %}selected{% endif %}>{{ get_text('price_desc') }}</option>
                <option value="name_asc" {% if sort_option == 'name_asc' %}selected{% endif %}>{{ get_text('name_asc') }}</option>
                <option value="name_desc" {% if sort_option == 'name_desc' %}selected{% endif %}>{{ get_text('name_desc') }}</option>
            </select>
        </form>
        {# Add filters for type/platform later if needed #}
    </div>

    <div class="games-grid">
        {% for game in games %}
        <div class="game-card">
            <div class="card-image">
                <img src="{{ url_for('static', filename=game.image_filename) }}" alt="{{ game.name }}">
                {# Optional: Add platform logo overlay #}
                {% if game.platform != 'other' %}
                <img src="{{ url_for('static', filename=game.platform + '.png') }}" alt="{{ game.platform }}" style="position: absolute; top: 10px; right: 10px; width: 30px; height: 30px; border-radius: 4px; background: rgba(0,0,0,0.5); padding: 3px;">
                {% endif %}
            </div>
            <div class="game-info">
                <h3>{{ game.name }}</h3>
                 <small style="color: var(--text-secondary); margin-bottom: 5px; display: block;">{{ get_text(game.game_type) }} - {{ get_text(game.platform) }}</small>
                <p>{{ game.description }}</p>
                <div class="price">
                    {% if currency == 'IQD' %}
                        {{ "{:,.0f}".format(game.price * IQD_RATE).replace(',', '.') }} د.ع
                    {% else %}
                        ${{ "%.2f"|format(game.price) }}
                    {% endif %}
                </div>
                <a href="{{ url_for('order_form', game_id=game.id) }}" class="buy-btn">{{ get_text('buy_now') }}</a>
            </div>
        </div>
        {% else %}
        <p style="text-align: center; color: var(--text-secondary); grid-column: 1 / -1;">{{ get_text('no_paid_games') }}</p> {# Span across grid #}
        {% endfor %}
    </div>
</div>
{% endblock %}